<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch the Droplets</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for Game Elements - essential for absolute positioning */
        #game-area {
            width: 100%;
            height: 400px;
            background-color: #5d9cec; /* A vibrant light blue/sky color */
            position: relative;
            overflow: hidden; /* Keeps falling objects inside */
            border-radius: 0.5rem;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            cursor: pointer; /* Indicate mouse control is available */
        }

        /* The Player's Catcher (Basket) */
        .catcher {
            position: absolute;
            bottom: 0;
            width: 100px;
            height: 25px;
            background-color: #8B4513; /* Saddle Brown */
            border-radius: 5px 5px 0 0;
            transition: transform 0.1s; /* Smooth movement */
        }

        /* A Good Droplet to Catch */
        .droplet {
            position: absolute;
            top: -20px;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); /* Blue gradient */
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0, 242, 254, 0.8);
        }

        /* A Bad Object to Avoid (Stone/Hazard) */
        .hazard {
            position: absolute;
            top: -20px;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, #a83f39 0%, #e85d40 100%); /* Red/Orange gradient */
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(232, 93, 64, 0.9);
        }

        /* NEW: Power-Up Object (Extra Life) */
        .powerup {
            position: absolute;
            top: -20px;
            width: 30px; /* Slightly larger */
            height: 30px;
            background: radial-gradient(circle, #ffeb3b 0%, #ffc107 100%); /* Gold/Yellow */
            border-radius: 50%;
            box-shadow: 0 0 15px #ffeb3b;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        /* Visual Feedback for HUD */
        .flash-green { background-color: #86efac !important; transition: background-color 0.1s; }
        .flash-red { background-color: #fca5a5 !important; transition: background-color 0.1s; }

        
        /* Game Over Screen overlay */
        #message-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen p-4" style="font-family: 'Inter', sans-serif;">

    <div id="game-container" class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-4 md:p-6 transition-all duration-300">
        <!-- HUD: Score and Lives -->
        <div id="hud" class="flex justify-between p-3 mb-4 bg-gray-100 rounded-lg text-lg font-bold text-gray-800 shadow-inner duration-200">
            <div id="score-display-container" class="flex items-center">
                <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2-3-.895-3-2 1.343-2 3-2z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9h-9"></path></svg>
                Score: <span id="score" class="ml-1 text-blue-600">0</span>
            </div>
            <div id="lives-display-container" class="flex items-center">
                <svg class="w-6 h-6 mr-2 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                Lives: <span id="lives" class="ml-1 text-red-500">3</span>
            </div>
        </div>
        
        <!-- Game Area Canvas -->
        <div id="game-area">
            <!-- Message Screen (Game Over/Start) -->
            <div id="message-screen" class="hidden">
                <h1 id="message-title" class="text-4xl font-extrabold mb-4 animate-pulse">Catch the Droplets</h1>
                <p id="message-text" class="text-xl mb-8">Move the basket with the **LEFT/RIGHT ARROW keys** or by **moving your MOUSE**.</p>
                <button onclick="startGame()" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-full shadow-lg transform transition duration-150 ease-in-out hover:scale-105">
                    Start Game
                </button>
            </div>
            <!-- The catcher will be added here by JavaScript -->
        </div>

        <p class="text-center text-sm text-gray-500 mt-4">Collect blue droplets, avoid red hazards, and grab gold power-ups!</p>
    </div>

    <script>
        // --- Game State Variables and Constants ---
        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score');
        const livesDisplay = document.getElementById('lives');
        const messageScreen = document.getElementById('message-screen');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const hudElement = document.getElementById('hud');
        
        const HAZARD_CHANCE = 0.25; // 25% chance of a hazard
        const POWERUP_CHANCE = 0.05; // 5% chance of a powerup
        
        let score = 0;
        let lives = 3;
        let catcherX; 
        let gameAreaWidth;
        let gameInterval;
        let spawnInterval;
        let catcher;
        let isGameRunning = false;


        // --- Setup and Start Game ---

        function setupCatcher() {
            // Calculate dimensions based on current window size
            gameAreaWidth = gameArea.offsetWidth;
            catcherX = gameAreaWidth / 2 - 50; // 50 is half of the 100px catcher width

            catcher = document.createElement('div');
            catcher.className = 'catcher';
            gameArea.appendChild(catcher);
            updateCatcherPosition();
        }

        function updateCatcherPosition() {
            if (catcher) {
                catcher.style.left = catcherX + 'px';
            }
        }

        function startGame() {
            // Reset state
            score = 0;
            lives = 3;
            isGameRunning = true;
            scoreDisplay.textContent = score;
            livesDisplay.textContent = lives;
            messageScreen.classList.add('hidden');
            
            // Clear old objects and intervals
            gameArea.querySelectorAll('.droplet, .hazard, .powerup').forEach(el => el.remove());
            clearInterval(gameInterval);
            clearInterval(spawnInterval);

            // Setup Catcher (if not already set up)
            if (!catcher) setupCatcher();

            // Setup event listeners
            window.addEventListener('resize', handleResize);
            gameArea.addEventListener('mousemove', handleMouseMove);

            // Set up Game Loop (60 frames per second)
            gameInterval = setInterval(gameLoop, 1000 / 60); 
            // Set up Spawning (new object every 1.2 - 1.5 seconds)
            spawnInterval = setInterval(spawnObject, 1200 + Math.random() * 300); 
        }

        function handleResize() {
            // Recalculate game area width on resize
            gameAreaWidth = gameArea.offsetWidth;
            // Prevent catcher from going out of bounds if window shrinks
            const catcherWidth = 100;
            if (catcherX > gameAreaWidth - catcherWidth) {
                 catcherX = gameAreaWidth - catcherWidth;
            }
            updateCatcherPosition();
        }

        // --- Player Movement ---

        // Keyboard Movement
        document.addEventListener('keydown', (e) => {
            if (!isGameRunning) return; 
            
            const speed = 15;
            const catcherWidth = 100;
            
            if (e.key === 'ArrowLeft') {
                catcherX = Math.max(0, catcherX - speed);
            } else if (e.key === 'ArrowRight') {
                catcherX = Math.min(gameAreaWidth - catcherWidth, catcherX + speed);
            }
            updateCatcherPosition();
        });

        // Mouse Movement
        function handleMouseMove(e) {
            if (!isGameRunning) return;

            const gameAreaRect = gameArea.getBoundingClientRect();
            const mouseX = e.clientX;
            const catcherWidth = 100;

            // Calculate catcher position relative to the game area, centering the catcher under the cursor
            let newCatcherX = mouseX - gameAreaRect.left - (catcherWidth / 2);

            // Clamp the position to stay within bounds
            newCatcherX = Math.max(0, newCatcherX);
            newCatcherX = Math.min(gameAreaWidth - catcherWidth, newCatcherX);
            
            catcherX = newCatcherX;
            updateCatcherPosition();
        }

        // --- Object Spawning ---
        function spawnObject() {
            // Determine object type based on probability
            const rand = Math.random();
            let objectClass;

            if (rand < POWERUP_CHANCE) {
                objectClass = 'powerup';
            } else if (rand < POWERUP_CHANCE + HAZARD_CHANCE) {
                objectClass = 'hazard';
            } else {
                objectClass = 'droplet';
            }

            const object = document.createElement('div');
            object.className = objectClass;
            
            // Determine object size (Powerup is 30px, others are 25px)
            const objectSize = objectClass === 'powerup' ? 30 : 25; 
            
            // Random horizontal position within the game area boundaries
            const objectX = Math.random() * (gameAreaWidth - objectSize); 
            object.style.left = objectX + 'px';
            
            gameArea.appendChild(object);
        }

        // --- Visual Feedback ---
        function flashElement(type) {
            const className = type === 'green' ? 'flash-green' : 'flash-red';
            
            hudElement.classList.add(className);
            
            setTimeout(() => {
                hudElement.classList.remove(className);
            }, 200);
        }

        // --- Game Loop (Runs 60 times per second) ---
        function gameLoop() {
            const fallingObjects = gameArea.querySelectorAll('.droplet, .hazard, .powerup');

            fallingObjects.forEach(object => {
                let y = parseInt(object.style.top || -20);
                // Speed increases slightly with score for difficulty
                const baseSpeed = 2; // Speed reduced from 3 to 2
                const difficultyBonus = Math.min(score / 20, 3) * 0.1; 
                const speed = baseSpeed + difficultyBonus;

                y += speed;
                object.style.top = y + 'px';

                // Check for falling off the screen
                if (y > gameArea.offsetHeight - 20) { 
                    handleMiss(object);
                } 
                // Check for collision with the catcher
                else if (checkCollision(object)) {
                    handleCatch(object);
                }
            });

            if (lives <= 0) {
                endGame();
            }
        }

        // --- Collision Detection ---
        function checkCollision(object) {
            if (!catcher) return false;

            const catcherRect = catcher.getBoundingClientRect();
            const objectRect = object.getBoundingClientRect();

            // Check if the object's bottom edge is hitting the catcher's top edge
            const isHittingCatcherY = objectRect.bottom > catcherRect.top && objectRect.bottom < catcherRect.bottom + 5;
            
            // Check for horizontal overlap
            const isHorizontallyAligned = objectRect.left < catcherRect.right && objectRect.right > catcherRect.left;

            return isHittingCatcherY && isHorizontallyAligned;
        }

        // --- Event Handlers ---
        function handleCatch(object) {
            const objectClass = object.className;
            
            if (objectClass === 'droplet') {
                score++;
                flashElement('green');
            } else if (objectClass === 'hazard') {
                lives--; // Lose a life for catching a hazard
                flashElement('red');
            } else if (objectClass === 'powerup') {
                lives++; // Gain an extra life
                flashElement('green');
            }
            
            scoreDisplay.textContent = score;
            livesDisplay.textContent = lives;
            object.remove();
        }

        function handleMiss(object) {
            const objectClass = object.className;

            // Lose a life for missing a good item
            if (objectClass === 'droplet' || objectClass === 'powerup') {
                lives--; 
                flashElement('red');
            }
            // Hazards falling off are a non-penalty miss
            
            livesDisplay.textContent = lives;
            object.remove();
        }

        // --- End Game ---
        function endGame() {
            isGameRunning = false;
            clearInterval(gameInterval);
            clearInterval(spawnInterval);
            
            // Clean up event listeners
            window.removeEventListener('resize', handleResize);
            gameArea.removeEventListener('mousemove', handleMouseMove);

            // Update Game Over screen content
            messageTitle.textContent = 'Game Over!';
            messageText.innerHTML = `Final Score: <span class="text-yellow-400 font-bold">${score}</span>`;
            
            // Show the screen
            const button = messageScreen.querySelector('button');
            button.textContent = 'Play Again';
            messageScreen.classList.remove('hidden');
        }

        // Initialize the game setup on window load, but show the start screen first
        window.onload = () => {
             // Setup catcher initially
             setupCatcher(); 
             // Show the initial start screen with instructions
             messageScreen.classList.remove('hidden');
        };
    </script>
</body>
</html>